<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Healthcare Management System</title>
</head>
<body>
<h1>Healthcare Management System</h1>

<!-- ================= PATIENTS ================= -->
<h2>Patients</h2>
<button onclick="loadPatients()">Load Patients</button>
<ul id="patients"></ul>

<h3>Add Patient</h3>
<input id="patientName" placeholder="Name">
<input id="patientAge" type="number" placeholder="Age">
<button onclick="createPatient()">Add Patient</button>

<!-- ================= MED PROFESSIONALS ================= -->
<h2>Med Professionals</h2>
<button onclick="loadDoctors()">Load Doctors</button>
<ul id="doctors"></ul>

<h3>Add Doctor</h3>
<input id="doctorName" placeholder="Doctor Name">
<input id="doctorSpec" placeholder="Specialization">
<input id="doctorExp" type="number" placeholder="Experience">
<button onclick="createDoctor()">Add Doctor</button>

<!-- ================= HOSPITALS ================= -->
<h2>Hospitals</h2>
<button onclick="loadHospitals()">Load Hospitals</button>
<ul id="hospitals"></ul>

<h3>Update Hospital Rating</h3>
<input id="hospitalName" placeholder="Hospital Name">
<input id="hospitalRating" type="number" placeholder="New Rating">
<button onclick="updateHospitalRating()">Update Rating</button>

<!--&lt;!&ndash; ================= APPOINTMENTS ================= &ndash;&gt;-->
<!--<h2>Appointments</h2>-->
<!--<button onclick="loadAppointments()">Load Appointments</button>-->
<!--<ul id="appointments"></ul>-->

<!--<h3>Create Appointment</h3>-->
<!--<input id="appPatient" placeholder="Patient Name">-->
<!--<input id="appDoctor" placeholder="Doctor Name">-->
<!--<input id="appHospital" placeholder="Hospital Name">-->
<!--<input id="appDateTime" type="datetime-local">-->
<!--<button onclick="createAppointment()">Create Appointment</button>-->

<script>
    const BASE_URL = "http://localhost:8081";

    // ================= PATIENTS =================
    async function loadPatients() {
        const res = await fetch(`${BASE_URL}/patients`);
        const data = await res.json();
        const list = document.getElementById("patients");
        list.innerHTML = "";
        data.forEach(p => {
            list.innerHTML += `
        <li>
            ${p.name} (${p.age})
            <button onclick="deletePatient('${p.name}')">Delete</button>
            <button onclick="updatePatientPrompt('${p.name}', ${p.age})">Update</button>
        </li>`;
        });
    }

    async function createPatient() {
        const name = document.getElementById("patientName").value;
        const age = Number(document.getElementById("patientAge").value);
        await fetch(`${BASE_URL}/patients`, {
            method: "POST",
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name, age})
        });
        loadPatients();
    }

    async function deletePatient(name) {
        await fetch(`${BASE_URL}/patients/delete/${name}`, { method: "DELETE" });
        loadPatients();
    }

    function updatePatientPrompt(name, age) {
        const newAge = prompt("New age:", age);
        if(newAge) updatePatient(name, Number(newAge));
    }

    async function updatePatient(name, newAge) {
        await fetch(`${BASE_URL}/patients/update/${name}?age=${newAge}`, { method: "PUT" });
        loadPatients();
    }

    // ================= MED PROFESSIONALS =================

    // Загрузка списка врачей
    async function loadDoctors() {
        const res = await fetch(`${BASE_URL}/meds`);
        const data = await res.json();
        const list = document.getElementById("doctors");
        list.innerHTML = "";
        data.forEach(d => {
            list.innerHTML += `
        <li>
            ${d.name} | ${d.specialization} | ${d.experience} years
            <button onclick="deleteDoctor('${d.name}')">Delete</button>
            <button onclick="updateDoctorPrompt('${d.name}', ${d.experience})">Update</button>
        </li>`;
        });
    }

    // Создание нового врача
    async function createDoctor() {
        const name = document.getElementById("doctorName").value;
        const specialization = document.getElementById("doctorSpec").value;
        const experience = parseInt(document.getElementById("doctorExp").value);

        await fetch(`${BASE_URL}/meds`, {
            method: "POST",
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, specialization, experience })
        });

        await loadDoctors();
    }

    // Удаление врача по имени
    async function deleteDoctor(name) {
        await fetch(`${BASE_URL}/meds/${encodeURIComponent(name)}`, { method: "DELETE" });
        loadDoctors();
    }

    // Запрос нового опыта
    function updateDoctorPrompt(name, oldExp) {
        const newExp = parseInt(prompt("New experience:", oldExp));
        if (!isNaN(newExp)) {
            updateDoctor(name, newExp);
        }
    }

    // Обновление опыта врача по имени
    async function updateDoctor(name, newExp) {
        await fetch(`${BASE_URL}/meds/${encodeURIComponent(name)}/experience?experience=${newExp}`, {
            method: "PUT"
        });


        loadDoctors();
    }

    // ================= HOSPITALS =================
    async function loadHospitals() {
        const res = await fetch(`${BASE_URL}/hospitals`);
        const data = await res.json();
        const list = document.getElementById("hospitals");
        list.innerHTML = "";
        data.forEach(h => {
            list.innerHTML += `
        <li>
            ${h.name} | Doctors: ${h.capacity} | Rating: ${h.rating}
        </li>`;
        });
    }

    async function updateHospitalRating() {
        const name = document.getElementById("hospitalName").value;
        const rating = Number(document.getElementById("hospitalRating").value);
        await fetch(`${BASE_URL}/hospitals/${name}/rating?rating=${rating}`, { method: "PUT" });
        loadHospitals();
    }

    // // ================= APPOINTMENTS =================
    // async function loadAppointments() {
    //     const res = await fetch(BASE_URL + "/appointments");
    //     const data = await res.json();
    //     const list = document.getElementById("appointments");
    //     list.innerHTML = "";
    //     data.forEach(a => {
    //         list.innerHTML += `<li>
    //         Patient: ${a.patient.name} → Doctor: ${a.doctor.name} → Hospital: ${a.hospital.name} → Date: ${a.dateTime}
    //         <button onclick="deleteAppointment(${a.id})">Delete</button>
    //     </li>`;
    //     });
    // }
    // async function createAppointment() {
    //     const patientName = document.getElementById("appPatient").value;
    //     const doctorName = document.getElementById("appDoctor").value;
    //     const hospitalName = document.getElementById("appHospital").value;
    //     const dateTime = document.getElementById("appDateTime").value;
    //
    //     await fetch(BASE_URL + "/appointments", {
    //         method: "POST",
    //         headers: { 'Content-Type': 'application/json' },
    //         body: JSON.stringify({ patientName, doctorName, hospitalName, dateTime })
    //     });
    //
    //     loadAppointments();
    // }
    // async function deleteAppointment(id) {
    //     await fetch(BASE_URL + "/appointments/" + id, { method: "DELETE" });
    //     loadAppointments();
    // }
</script>
</body>
</html>
